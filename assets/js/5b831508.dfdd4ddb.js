"use strict";(self.webpackChunkdocsite_poc_github_io=self.webpackChunkdocsite_poc_github_io||[]).push([[16142],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var o=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=o.createContext({}),l=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=l(e.components);return o.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),m=l(t),u=i,h=m["".concat(s,".").concat(u)]||m[u]||d[u]||r;return t?o.createElement(h,a(a({ref:n},c),{},{components:t})):o.createElement(h,a({ref:n},c))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,a=new Array(r);a[0]=m;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p.mdxType="string"==typeof e?e:i,a[1]=p;for(var l=2;l<r;l++)a[l]=t[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},58295:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>p,toc:()=>l});var o=t(87462),i=(t(67294),t(3905));const r={title:"Monitoring",date:"2021-10-04",sidebar_position:10},a=void 0,p={unversionedId:"pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/index",id:"pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/index",title:"Monitoring",description:"Enrich app has monitoring built in, to help the pipeline operator.",source:"@site/docs/pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/index.md",sourceDirName:"pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring",slug:"/pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/",permalink:"/docs/pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/",draft:!1,editUrl:"https://github.com/snowplow/snowplow.github.io/tree/main/docs/pipeline-components-and-applications/enrichment-components/enrich-pubsub/monitoring/index.md",tags:[],version:"current",lastUpdatedAt:1661183915,formattedLastUpdatedAt:"Aug 22, 2022",sidebarPosition:10,frontMatter:{title:"Monitoring",date:"2021-10-04",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"enrich-pubsub (GCP) and enrich-kinesis (AWS)",permalink:"/docs/pipeline-components-and-applications/enrichment-components/enrich-pubsub/"},next:{title:"Configuration",permalink:"/docs/pipeline-components-and-applications/enrichment-components/enrich-pubsub/configuration-reference/"}},s={},l=[{value:"Statsd",id:"statsd",level:2},{value:"stdout",id:"stdout",level:2},{value:"Sentry",id:"sentry",level:2},{value:"Cloudwatch (for enrich-kinesis)",id:"cloudwatch-for-enrich-kinesis",level:2}],c={toc:l};function d(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Enrich app has monitoring built in, to help the pipeline operator."),(0,i.kt)("h2",{id:"statsd"},"Statsd",(0,i.kt)("a",{parentName:"h2",href:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader/monitoring/#statsd"})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/statsd/statsd"},"Statsd"),"\xa0is a daemon that aggregates and summarizes application metrics. It receives metrics sent by the application over UDP, and then periodically flushes the aggregated metrics to a\xa0",(0,i.kt)("a",{parentName:"p",href:"https://github.com/statsd/statsd/blob/master/docs/backend.md"},"pluggable storage backend"),"."),(0,i.kt)("p",null,"Enrich can periodically emit event-based metrics to a statsd daemon. Here is a string representation of the metrics it sends:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snowplow.enrich.raw:42|c|#tag1:value1\nsnowplow.enrich.good:30|c|#tag1:value1\nsnowplow.enrich.bad:12|c|#tag1:value1\nsnowplow.enrich.latency:123.4|g|#tag1:value1\nsnowplow.enrich.invalid_enriched:0|c|#tag1:value1\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"raw"),": total number of raw collector payloads received."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"good"),": total number of good events successfully enriched."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"bad"),": total number of failed events, e.g. due to schema violations, invalid collector payload, or an enrichment failure."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"latency"),": time difference between the collector timestamp and time the event is emitted to the output stream"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"invalid_enriched"),": number of enriched events that were not valid against ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/snowplow/iglu-central/blob/master/schemas/com.snowplowanalytics.snowplow/atomic/jsonschema/1-0-0"},"atomic")," schema")),(0,i.kt)("p",null,"Note, the count metrics (",(0,i.kt)("inlineCode",{parentName:"p"},"raw"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"good"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"bad")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"invalid_enriched"),") refer to the updated count since the previous metric was emitted. A collector payload can carry multiple events, so it is possible for ",(0,i.kt)("inlineCode",{parentName:"p"},"good")," to be larger than ",(0,i.kt)("inlineCode",{parentName:"p"},"raw"),"."),(0,i.kt)("p",null,"Statsd monitoring is configured by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"monitoring.metrics.statsd"),"\xa0section in\xa0",(0,i.kt)("a",{parentName:"p",href:"/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader/configuration-reference/"},"the hocon file"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"monitoring": {\n  "metrics": {\n    "hostname": "localhost"\n    "port": 8125\n    "tags": {\n      "tag1": "value1"\n      "tag2": "value2"\n    }\n    "prefix": "snowplow.enrich."\n    "period": "10 seconds"\n  }\n}\n')),(0,i.kt)("h2",{id:"stdout"},"stdout"),(0,i.kt)("p",null,"Above metrics can also be printed in the logs (with log level ",(0,i.kt)("inlineCode",{parentName:"p"},"info"),")."),(0,i.kt)("p",null,"To do that, this section needs to appear in the configuration file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"monitoring": {\n  "metrics": {\n    "stdout": {\n      "period": "1 minute"\n      "prefix": "snowplow.enrich."\n    }\n  }\n}\n')),(0,i.kt)("h2",{id:"sentry"},"Sentry",(0,i.kt)("a",{parentName:"h2",href:"/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader/monitoring/#sentry"})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.sentry.io/"},"Sentry"),"\xa0is a popular error monitoring service, which helps developers diagnose and fix problems in an application. Enrich can send an error report to sentry whenever something unexpected happens when trying to enrich an event. The reasons for the error can then be explored in the sentry server\u2019s UI."),(0,i.kt)("p",null,"Sentry monitoring is configured by setting the\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"monitoring.sentry.dsn"),"\xa0key in\xa0",(0,i.kt)("a",{parentName:"p",href:"/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader/configuration-reference/"},"the hocon file"),"\xa0with the url of your sentry server:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"monitoring": {\n  "dsn": "http://sentry.acme.com"\n}\n')),(0,i.kt)("h2",{id:"cloudwatch-for-enrich-kinesis"},"Cloudwatch (for enrich-kinesis)"),(0,i.kt)("p",null,"It's possible to send KCL and KPL metrics to Cloudwatch by adding this section to the config file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"monitoring": {\n  "cloudwatch": true\n}\n')))}d.isMDXComponent=!0}}]);